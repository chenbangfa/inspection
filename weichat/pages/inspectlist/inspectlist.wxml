<nav-bar navbar-data='{{navbarData}}'></nav-bar>
<view style="float: left; width: 100%;margin-top:{{height}}px;   padding-bottom:80px;">
<view style="width: 98%;  float: left; font-size: 14px; color: #333;position: fixed; background-color: #f9f9f9; padding: 10px 0; z-index:99;">
<span bindtap="datashow" style="padding:5px 8px; background-color: #e9e9e9; border-radius: 3px;margin-left:1%; float: left;">日期</span>
<span bindtap="getpeople" style="padding:5px 8px; background-color: #e9e9e9; border-radius: 3px;margin-left:1%; float: left;">人员</span>
<span bindtap="getzylist" style="padding:5px 8px; background-color: #e9e9e9; border-radius: 3px;margin-left:1%; float: left;">隐患</span>
<picker range="{{zgArray}}" value="{{zgIndex}}" bindchange="bindZgStateChange" style="float:left; margin-left:1%;">
  <span style="padding:5px 8px; background-color: #e9e9e9; border-radius: 3px; float: left;">{{zgArray[zgIndex]}}</span>
</picker>
<span bindtap="showteamlist" style="padding:5px 8px; background-color: #e9e9e9; border-radius: 3px;margin-left:1%; float: left;">团队</span>
<span bindtap="toggleBatchMode" style="padding:5px 8px; background-color: {{isBatchMode?'#ff9800':'#2A82E4'}}; color:#fff; border-radius: 3px;margin-left:1%; float: left;">{{isBatchMode?'取消':'批量'}}</span>

</view>
<view style="margin-left:1%;margin-top:45px; float: left; width:99%; font-size: 14px; background-color: #fff; line-height: 24px; color: #333; padding-bottom: 5px;">
<block wx:if="{{sdate!=''||together!=''||zysearch!=''||tName!=''}}" >
<view style="font-weight: bold;">查询条件</view>
<view style="width: 100%; float: left;" wx:if="{{sdate!=''}}">开始日期：{{sdate}}</view>
<view style="width: 100%; float: left;" wx:if="{{edate!=''}}">结束日期：{{edate}} 
<span bindtap="closedate" style=" background-color: #fad4b3; padding:2px 10px; border-radius: 6px; margin-left: 10px; font-size: 12px;">
  <image src="../../image/close.png" style="width:10px; height:10px;"/>
</span></view>
<view style="width: 100%; float: left;" wx:if="{{together!=''}}">巡检人员：{{together}}
<span bindtap="closehy" style=" background-color: #fad4b3; padding:2px 10px; border-radius: 6px; margin-left: 10px; font-size: 12px;">
  <image src="../../image/close.png" style="width:10px; height:10px;"/>
</span></view>
<view style="width: 100%; float: left;" wx:if="{{zysearch!=''}}">隐患分类：{{zysearch}}
<span bindtap="closezy" style=" background-color: #fad4b3; padding:2px 10px; border-radius: 6px; margin-left: 10px; font-size: 12px;">
  <image src="../../image/close.png" style="width:10px; height:10px;"/>
</span></view>
<view style="width: 100%; float: left;" wx:if="{{tName!=''}}">当前团队：{{tName}}</view>
</block>
</view>

<!-- List Area -->
<checkbox-group bindchange="checkboxChange">
<view wx:for="{{odlist}}" wx:for-item="articles" wx:key="id" wx:for-index="id" style="float: left; width: 100%;">
  <view wx:for="{{articles}}" wx:for-item="item" wx:key="id" wx:for-index="index" class="articles" style="display: flex; align-items: center;">
    <checkbox wx:if="{{isBatchMode}}" value="{{item.id}}" checked="{{allSelected}}" style="margin-left: 10px;"></checkbox>
    
  <navigator url="../inspectinfo/inspectinfo?id={{item.id}}" style="flex:1;">
    <view class="vpic">
    <image src='https://xj.tajian.cc/{{item.hypic}}' class="pic" mode="aspectFill"></image>
    </view> 
    <view class="vtit">
      <view class="tit">{{item.gsName}}</view>
      <span class="vspan">{{item.hyName}}</span>
    </view>    
    <view class="vinfo">
      <view class="vlist">{{item.yhContent}}</view>
      
    </view> 
    <view class="vinfo">
      
      <view class="vlist">{{item.addTime}}</view>
    </view>   
    <view class="vinfo">
      <image src='../../image/wz.png' class="addpic"></image>
      <view class="vlist">{{item.posAdd}}</view>
    </view>
    <view class="vinfo" wx:if="{{item.zgState==1}}">
        <text style="color:#ff9800; font-size:12px;">整改中: {{item.zgName}}</text>
    </view>
    <view class="vinfo" wx:if="{{item.zgState==2}}">
        <text style="color:#09bb07; font-size:12px;">已整改: {{item.zgName}}</text>
    </view>
    <span class="arrow"></span>
  </navigator>
  </view>
</view>
</checkbox-group>

<view class="vnodata" wx:if="{{isdata}}">
<view>没有巡检记录~</view>
</view>
</view>

<!-- Bottom Bar: Normal Mode -->
<view wx:if="{{!isBatchMode}}" style="height: 50px; float:left;width: 100%;position: fixed;bottom: 0px; border-top: 1px solid #e6e6e6; padding: 10px 0; z-index: 999; background-color: #fff; bottom: 0; z-index: 8888;">
<view style="float: left;width: 30%; padding:8px 0; margin-left: 10px;">合计：{{count}} 条</view>
  <view style="color: #333; border:1px solid #e6e6e6; padding:8px 0; background-color: #e6e6e6; border-radius:9px; width:40%;float: right; text-align: center;  margin-right: 10px;" bindtap="download">导出Excel</view>
</view>

<!-- Bottom Bar: Batch Mode -->
<view wx:if="{{isBatchMode}}" style="height: 50px; float:left;width: 100%;position: fixed;bottom: 0px; border-top: 1px solid #e6e6e6; padding: 10px 0; z-index: 999; background-color: #fff; bottom: 0; z-index: 8888; display:flex; justify-content:space-around; align-items:center;">
  <button size="mini" bindtap="selectAll">全选</button>
  <button size="mini" type="primary" bindtap="showAssignModal">分配整改 ({{selectedItems.length}})</button>
</view>

<!-- Existing Modals ... -->

<view class="commodity_screen" wx:if="{{editshow}}"></view>
<view class="commodity_attr_box" wx:if="{{editshow}}" style="top:{{height}}px; background-color: #f1f1f1;">
<view style=" padding-bottom: 10px; font-size: 16px; width: 100%; float: left;">
<span style="float: left; margin-left: 10px; font-size: 16px;">日期查询</span >
<view style=" float: right; margin-right: 10px;" bindtap="hideeditshow"><image src="../../image/close.png" style="width: 20px; height:20px;"/></view>
</view>
<view style=" float: left; width: 100%;background-color: #fff; line-height: 32px;">
<view style="width: 97%; float: left;">
  <span class='dataspan' bindtap="dataserach" data-typedata="全部">全部</span>
  <span class='dataspan' bindtap="dataserach" data-typedata="今日">今日</span>
  <span class='dataspan' bindtap="dataserach" data-typedata="昨日">昨日</span>  
  <span class='dataspan' bindtap="dataserach" data-typedata="上周">上周</span>
  <span class='dataspan' bindtap="dataserach" data-typedata="本周">本周</span>
  <span class='dataspan' bindtap="dataserach" data-typedata="本月">本月</span>
  <span class='dataspan' bindtap="dataserach" data-typedata="本季">本季</span>
  <span class='dataspan' bindtap="dataserach" data-typedata="本年">本年</span>
</view>
<view style="width: 100%;float: left; margin-left: 3%; margin-top:10px;">
  <picker style=" float: left; width:45%;background-color: #f9f9f9; border-radius:3px;color: #666; font-size: 14px; text-align: center;" mode="date" value="{{sdate}}" bindchange="bindDateChange">
    <view style="margin-left: 10px;">
      {{sdate==''?'开始日期':sdate}}
    </view>
  </picker><span style="float: left;color: #666; width:4%;text-align: center; "> - </span>
  <picker style=" float: left; width:45%;background-color: #f9f9f9; border-radius:3px;color: #666; font-size: 14px; text-align: center;" mode="date" value="{{edate}}" bindchange="endDateChange">
    <view style="margin-left: 10px;">
      {{edate==''?'结束日期':edate}}
    </view>
  </picker>
</view>
</view>
<view style="width:100%;  text-align: center; padding-bottom: 20px;background-color: #fff; float: left; padding-top:20px;  border-bottom-left-radius: 12px; border-bottom-right-radius: 12px;">
<button type="primary" bindtap="searchdate" style="width:30%; line-height:36px; font-size: 16px;">搜索</button>
</view>
</view>

<view class="commodity_screen" wx:if="{{peopleshow}}"></view>
<view class="commodity_attr_box" wx:if="{{peopleshow}}" style="top:{{height}}px; background-color: #f1f1f1;">
<view style=" padding-bottom: 10px; font-size: 16px; width: 100%; float: left;">
<span style="float: left; margin-left: 10px; font-size: 16px;">巡检人查询</span >
<view style=" float: right; margin-right: 10px;" bindtap="hidepeople"><image src="../../image/close.png" style="width: 20px; height:20px;"/></view>
</view>
<view style=" float: left; width: 100%;background-color: #fff; line-height: 36px;">
  <checkbox-group bindchange="peoplechange">
  <label wx:for="{{people}}" wx:key="index" style="width: 30%; margin-left:2%;float: left;">
  <checkbox value="{{item.hyName}}">{{item.hyName}}</checkbox>
  </label>
  </checkbox-group>
</view>
<view style="width:100%;  text-align: center; padding-bottom: 20px;background-color: #fff; float: left; padding-top:20px;  border-bottom-left-radius: 12px; border-bottom-right-radius: 12px;">
<button type="primary" bindtap="searchhy" style="width:30%; line-height:36px; font-size: 16px;">搜索</button>
</view>
</view>

<view class="commodity_screen" wx:if="{{zyshow}}"></view>
<view class="commodity_attr_box" wx:if="{{zyshow}}" style="top:{{height}}px; background-color: #f1f1f1;">
<view style=" padding-bottom: 10px; font-size: 16px; width: 100%; float: left;">
<span style="float: left; margin-left: 10px; font-size: 16px;">隐患分类查询</span >
<view style=" float: right; margin-right: 10px;" bindtap="hidezyshow"><image src="../../image/close.png" style="width: 20px; height:20px;"/></view>
</view>
<view style=" float: left; width: 100%;background-color: #fff; line-height: 36px;">
  <checkbox-group bindchange="zychange">
  <label wx:for="{{zylist}}" wx:key="index" style="width: 30%; margin-left:2%;float: left;">
  <checkbox value="{{item.gName}}">{{item.gName}}</checkbox>
  </label>
  </checkbox-group>
</view>
<view style="width:100%;  text-align: center; padding-bottom: 20px;background-color: #fff; float: left; padding-top:20px;  border-bottom-left-radius: 12px; border-bottom-right-radius: 12px;">
<button type="primary" bindtap="searchzy" style="width:30%; line-height:36px; font-size: 16px;">搜索</button>
</view>
</view>


<view class="commodity_screen" wx:if="{{teamshow}}"></view>
<view class="commodity_attr_box" wx:if="{{teamshow}}" style="top:{{height}}px; background-color: #f1f1f1;">
<view style=" padding-bottom: 10px; font-size: 16px; width: 100%; float: left;">
<span style="float: left; margin-left: 10px; font-size: 16px;">团队查询</span >
<view style=" float: right; margin-right: 10px;" bindtap="hideteam"><image src="../../image/close.png" style="width: 20px; height:20px;"/></view>
</view>
<view style=" float: left; width: 100%;background-color: #fff; line-height: 36px;">
  <radio-group bindchange="teamchange">
  <label wx:for="{{teamlist}}" wx:key="index" style="width: 100%; margin-left:2%;float: left;">
  <radio value="{{item.tId}}">{{item.tName}}</radio>
  </label>
  </radio-group>
</view>
<view style="width:100%;  text-align: center; padding-bottom: 10px;background-color: #fff; float: left; padding-top:10px;  border-bottom-left-radius: 12px; border-bottom-right-radius: 12px;">
</view>
</view>

<!-- Assignment Modal -->
<view class="commodity_screen" wx:if="{{assignShow}}"></view>
<view class="commodity_attr_box" wx:if="{{assignShow}}" style="top:{{height}}px; background-color: #f1f1f1; padding: 20px;">
    <view style="font-size: 16px; margin-bottom: 15px; text-align: center;">分配整改任务</view>
    
    <view style="margin-bottom: 10px;">
        <picker range="{{people}}" range-key="hyName" bindchange="bindAssignUserChange">
             <view style="background:#fff; padding: 10px; border-radius: 4px;">
                指定整改人：{{assignUserIndex > -1 ? people[assignUserIndex].hyName : '请选择'}}
             </view>
        </picker>
    </view>
    
    <view style="margin-bottom: 10px;">
        <input placeholder="请输入整改要求" bindinput="inputAssignRequest" style="background:#fff; padding: 10px; border-radius: 4px;"/>
    </view>
    
    <view style="margin-bottom: 10px;">
        <picker mode="date" bindchange="bindAssignDateChange">
             <view style="background:#fff; padding: 10px; border-radius: 4px;">
                整改期限：{{assignDeadline || '请选择'}}
             </view>
        </picker>
    </view>
    
    <view style="display: flex; justify-content: space-between; margin-top: 20px;">
        <button bindtap="hideAssignModal" style="width:45%;">取消</button>
        <button type="primary" bindtap="submitAssignment" style="width:45%;">确认分配</button>
    </view>
</view>

